= Программное описание: Worker Node (ПРД-3)

== Описание компонента

Данный компонент представляет собой прошивку для микроконтроллера STM32, которая реализует прием и обработку пакетов данных по интерфейсу UART. Компонент работает в режиме slave и отвечает на команды от master-устройства.

== Основные функции

=== 1. Прием пакетов данных

* Прием пакетов по протоколу PRD-3 через UART1
* Парсинг структуры пакета с синхрословами `SYNC1 (0xAC)` и `SYNC2 (0x53)`
* Валидация длины пакета (`LEN: 4–253 байта`)

=== 2. Валидация пакетов

* *Проверка CRC:* вычисление и сравнение контрольной суммы CRC8 (полином `0x31`)
* *Проверка адреса:* валидация адреса устройства (`MY_DEVICE_ADDR = 0x01`)
* *Проверка параметров:* валидация параметров команды (закомментировано)

=== 3. Формирование ответных пакетов

* Формирование ответных пакетов согласно протоколу PRD-3
* Отправка кодов подтверждения (ACK):
** `ACK_OK (0)` - команда принята и декодирована
** `ACK_BAD_ADDR (1)` - неверный адрес устройства
** `ACK_BAD_CRC (2)` - ошибка CRC
** `ACK_BAD_PARAM (3)` - недопустимый параметр команды

=== 4. Управление пользовательской кнопкой

* Обработка нажатий пользовательской кнопки (PA0)
* Отправка тестовых ответных пакетов при нажатии кнопки

== Структура данных

=== RX_PACKET_T

[source,c]
----
typedef struct {
    uint8_t SQN;
    uint8_t ADDR;
    uint8_t CODE;
    uint8_t PARAM[MAX_DATA_SIZE];
    uint8_t PARAM_SIZE;
    uint8_t CRC_OK;
} RX_PACKET_T;
----

=== TX_RESPONSE_T

[source,c]
----
typedef struct {
    uint8_t SQN;
    uint8_t ADDR;
    uint8_t ACK;
    uint8_t DATA[MAX_DATA_SIZE];
    uint8_t DATA_SIZE;
} TX_RESPONSE_T;
----

== Формат пакета PRD-3

[source,text]
----
[SYNC1] [SYNC2] [LEN] [SQN] [ADDR] [CMD] [PARAM...] [CRC]
----

[source,text]
----
[SYNC1] [SYNC2] [LEN] [SQN] [ADDR] [ACK] [DATA...] [CRC]
----
