= Техническое описание: G-code Parser Unit


== Описание компонента

Данный компонент реализует парсер и интерпретатор G-code команд для управления CNC станком. Модуль поддерживает основные команды перемещения (G00, G01, G02, G03), переключение режимов координат (G90, G91) и расчет количества шагов двигателя для достижения целевой точки.

== Основные функции

=== 1. Парсинг G-code команд

* Разбор строковых команд G-code
* Извлечение параметров (координаты X, Y, параметры дуг I, J, скорость подачи F)
* Поддержка абсолютного и относительного режимов координат

=== 2. Интерпретация команд перемещения

* **G00** - быстрое перемещение (rapid movement)
* **G01** - линейная интерполяция с заданной скоростью подачи
* **G02** - круговая интерполяция по часовой стрелке
* **G03** - круговая интерполяция против часовой стрелки

=== 3. Управление режимами координат

* **G90** - абсолютный режим координат
* **G91** - относительный режим координат

=== 4. Расчет шагов двигателя

* Вычисление количества шагов для оси X
* Вычисление количества шагов для оси Y
* Учет шага двигателя (step size)

== Структура данных

=== CNC_Start

Основная структура состояния CNC системы:

[source,c]
----
typedef struct {
    float prev_x;
    float prev_y;
    float x;
    float y;
    bool absolute;
    float feed_rate;
    bool rapid;
} CNC_Start;
----

== Поддерживаемые команды

=== G00 — Быстрое перемещение

[source,text]
----
G00 X<value> Y<value>
----

=== G01 — Линейная интерполяция

[source,text]
----
G01 X<value> Y<value> [F<value>]
----

=== G02 — Круговая интерполяция по часовой стрелке

[source,text]
----
G02 X<value> Y<value> I<value> J<value>
----

=== G03 — Круговая интерполяция против часовой стрелки

[source,text]
----
G03 X<value> Y<value> I<value> J<value>
----

=== G90 — Абсолютный режим координат

[source,text]
----
G90
----

=== G91 — Относительный режим координат

[source,text]
----
G91
----

=== F — Скорость подачи

[source,text]
----
F<value>
----

== Функции

* `cnc_init`
* `g00`
* `g01`
* `g02`
* `g03`
* `g90`
* `g91`
* `set_feed_rate`
* `parse_gcode`
* `nStepsToPointX`
* `nStepsToPointY`

== Алгоритм работы

. Инициализация системы
. Парсинг G-code команд
. Выполнение команд перемещения
. Обновление состояния системы
. Расчет шагов двигателя